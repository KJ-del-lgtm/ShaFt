<h2 class="mb-2 text-center bg-light p-2 rounded", style="width: 30%;"><%= @group.name %></h2>

<div class="d-flex gap-4">

  <div class="flex-grow-1 bg-white p-3 border rounded shadow-sm" style="min-height: 600px;">
    <%= month_calendar(events: @shifts) do |date, shifts_for_day| %>
      <div class="day-cell mb-2 p-2 border rounded">
        <strong><%= date.day %></strong>
        <% shifts_for_day.each do |shift| %>
          <div class="shift-entry mt-1 p-1 bg-light rounded">
            <div class="text-danger"><%= shift.user.name %></div> 
            (<%= shift.start_time.strftime("%H:%M") %> - <%= shift.end_time.strftime("%H:%M") %>)
            <% if @group.owner == current_user %>
              <%= link_to edit_group_shift_path(@group, shift), class: "btn btn-sm btn-outline-primary ms-2" do %>
                <i class="fa-solid fa-file-pen"></i>
              <% end %>
            <% end %>
          </div>
        <% end %>

        <% if @group.owner == current_user && shifts_for_day %>
          <%= link_to "+", new_group_shift_path(@group, date: date), class: "btn btn-sm btn-success mt-2" %>
        <% end %>
      </div>
    <% end %>
  </div>

  <div class="chat-box bg-white p-3 border rounded shadow-sm" style="width: 350px; display: flex; flex-direction: column; height: 600px;">
    <h4 class="mb-3 bg-info text-center rounded py-2">グループチャット</h4>

    <div class="chat-messages flex-grow-1 mb-3" style="overflow-y: auto;">
      <% @group.messages.each do |msg| %>
        <div class="mb-2 d-flex align-items-start">
          <%= image_tag msg.user.get_profile_image, size: "50x50", class: "rounded-circle me-2" %>
          <div>
            <strong><%= msg.user.name %>:</strong>
            <%= msg.content %>
            <br>
            <small class="text-muted"><%= msg.created_at.strftime("%H:%M") %></small>
          </div>
        </div>
      <% end %>
    </div>

    <div>
      <%= form_with model: [@group, Message.new], local: false do |f| %>
        <div class="input-group">
          <%= f.text_field :content, class: "form-control", placeholder: "メッセージを入力..." %>
          <button class="btn btn-primary">送信</button>
        </div>
      <% end %>
    </div>

    <div class="mt-4">
      <p class="text-center text-bg-info">グループ情報</p>

      <h4 class="mb-3">メンバー<%= @group.users.count %>人</h4>
      <div class="overflow-auto" style="max-height: 300px;">
        <ul class="list-group ">
          <% @group.users.each do |user| %>
            <li class="list-group-item d-flex align-items-center">
              <%= image_tag user.get_profile_image, size: "40x40", class: "rounded-circle me-2" %>
              <%= user.name %>
              <% if @group.owner == user %>
                <span class="badge bg-warning ms-auto">オーナー</span>
              <% end %>
            </li>
          <% end %>
        </ul>
      </div>
      <% if @group.owner == current_user %>
        <div class="mt-3 text-center">
          <%= link_to "グループを削除", group_path(@group), method: :delete, data: { confirm: "本当に削除しますか？" }, class: "btn btn-danger" %>
        </div>
      <% end %>
    </div>
  </div>
</div>

